<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Krishnendu's Blog</title>
  <meta name="description" content="Index of blog posts by Krishnendu" />
  <style>
    /* Minimal modern styling (no external deps). Tweak as needed. */
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#94a3b8; --accent:#7dd3fc;
      --glass: rgba(255,255,255,0.02);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%}
    body{
      margin:0; background: linear-gradient(180deg,#071029 0%, #071733 100%);
      color: #e6eef8; -webkit-font-smoothing:antialiased;
    }
    .wrap{max-width:1100px;margin:42px auto;padding:24px;}
    header{display:flex;align-items:center;gap:16px;margin-bottom:22px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#60a5fa);display:flex;align-items:center;justify-content:center;font-weight:700;color:#04203a}
    h1{margin:0;font-size:1.6rem}
    p.lead{margin:4px 0 0;color:var(--muted)}
    .controls{margin-top:14px;display:flex;gap:8px;flex-wrap:wrap}
    input.search{background:var(--glass);border:1px solid rgba(255,255,255,0.03);padding:10px 12px;border-radius:10px;color:inherit;min-width:260px}
    select{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:var(--glass);color:inherit}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px;margin-top:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:16px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .meta{font-size:13px;color:var(--muted);display:flex;justify-content:space-between;margin-bottom:8px}
    .title{font-weight:600;margin:2px 0 8px}
    .excerpt{color:var(--muted);font-size:14px;min-height:38px}
    .badges{display:flex;gap:6px;margin-top:12px;flex-wrap:wrap}
    .badge{font-size:12px;padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.02)}
    .actions{display:flex;gap:8px;margin-top:12px;align-items:center}
    .btn{padding:8px 10px;border-radius:8px;border:0;background:var(--accent);color:#04203a;font-weight:600;text-decoration:none}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted);font-weight:500}
    footer{margin-top:28px;color:var(--muted);font-size:13px;text-align:center}
    .empty{padding:28px;text-align:center;color:var(--muted);background:rgba(255,255,255,0.01);border-radius:10px}
    small.note{color:var(--muted)}
    @media (max-width:520px){ .controls{flex-direction:column} input.search{min-width:100%} }
  </style>
</head>
<!--
  IMPORTANT: set data-owner and data-repo to your GitHub user/org and repo name.
  Example: <body data-owner="krishnendu-krishnadas" data-repo="krishnendu-krishnadas.github.io" data-branch="main">
-->
<body data-owner="krishnendu-krishnadas" data-repo="krishnendu-krishnadas.github.io" data-branch="main">
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">B</div>
        <div>
          <h1>Blog index</h1>
          <p class="lead">List of blogs...</p>
        </div>
      </div>
    </header>

    <div class="controls">
      <input class="search" id="q" placeholder="Search titles or filenames..." />
      <select id="filterType">
        <option value="">All types</option>
        <option value="file">Files only</option>
        <option value="dir">Directories</option>
      </select>
      <select id="sort">
        <option value="name">Sort: name (Aâ†’Z)</option>
        <option value="name_desc">Sort: name (Zâ†’A)</option>
        <option value="type">Sort: type</option>
      </select>
      <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
        <small class="note" id="repoInfo">Loading...</small>
      </div>
    </div>

    <div id="results" class="grid" aria-live="polite"></div>

    <div id="empty" class="empty" style="display:none">No items found.</div>

    <footer>
      <div><small>Indexed from <span id="repoLink">â€”</span></small></div>
    </footer>
  </div>

  <script>
    /* ---------- Configuration & helpers ---------- */
    const body = document.body;
    let OWNER = body.dataset.owner || "";
    let REPO  = body.dataset.repo  || "";
    let BRANCH = body.dataset.branch || "main";
    const PATH = "AutoPublish/output/html"; // folder to index

    const resultsEl = document.getElementById("results");
    const repoInfoEl = document.getElementById("repoInfo");
    const repoLinkEl = document.getElementById("repoLink");
    const emptyEl = document.getElementById("empty");

    // Utility: friendly file size
    function niceSize(bytes){
      if(bytes == null) return "";
      const units=["B","KB","MB","GB"];
      let i=0; let n = bytes;
      while(n>=1024 && i<units.length-1){ n/=1024; i++}
      return `${Math.round(n*10)/10}${units[i]}`;
    }

    // Build url to view raw file on GitHub (raw.githubusercontent)
    function rawUrl(path){
      // raw URL template: https://raw.githubusercontent.com/{owner}/{repo}/{branch}/{path}
      return `https://raw.githubusercontent.com/${OWNER}/${REPO}/${BRANCH}/${path}`;
    }
    function githubUrl(path){
      return `https://github.com/${OWNER}/${REPO}/blob/${BRANCH}/${path}`;
    }

    // Render helpers
    function renderItem(item) {
        const isFile = item.type === "file";
        const name = item.name;
        const path = item.path;
        const size = niceSize(item.size);
        const title = name.replace(/\.html?$/i, '').replace(/[-_]/g, ' ');
        const excerpt = isFile
            ? `Click to view the rendered page.`
            : `Directory: ${name}`;
        
        // ðŸ‘‡ Use your live custom domain to render HTML files directly
        const domainBase = `https://${location.hostname}`; // works for custom domains too
        const openLink = isFile
            ? `${domainBase}/AutoPublish/output/html/${encodeURIComponent(name)}`
            : `https://github.com/${OWNER}/${REPO}/tree/${BRANCH}/${path}`;
        
        const openOnGH = `https://github.com/${OWNER}/${REPO}/blob/${BRANCH}/${path}`;

        return `
            <article class="card" data-name="${name.toLowerCase()}" data-type="${item.type}">
            <div class="meta">
                <span>${item.type.toUpperCase()}</span><span>${size}</span>
            </div>
            <div class="title">${title}</div>
            <div class="excerpt">${excerpt}</div>
            <div class="badges">
                <span class="badge">${path}</span>
            </div>
            <div class="actions">
                <a class="btn" href="${openLink}" target="_blank" rel="noopener">Open</a>
                <a class="btn ghost" href="${openOnGH}" target="_blank" rel="noopener">View on GitHub</a>
            </div>
            </article>
        `;
        }

    /* ---------- Core: fetch directory contents from GitHub API ---------- */
    async function fetchContents(){
      if(!OWNER || !REPO){
        repoInfoEl.textContent = "Repository not configured. Set data-owner and data-repo attributes on <body>.";
        repoLinkEl.textContent = "â€”";
        return [];
      }
      repoInfoEl.textContent = `${OWNER}/${REPO} @ ${BRANCH}`;
      repoLinkEl.innerHTML = `<a href="https://github.com/${OWNER}/${REPO}" target="_blank" rel="noopener" style="color:inherit;text-decoration:underline">${OWNER}/${REPO}</a>`;

      // GitHub API: GET /repos/{owner}/{repo}/contents/{path}
      const api = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${encodeURIComponent(PATH)}?ref=${encodeURIComponent(BRANCH)}`;

      try {
        const resp = await fetch(api, {headers: {'Accept':'application/vnd.github.v3+json'}});
        if(resp.status === 404){
          repoInfoEl.textContent = `Folder '/${PATH}' not found in ${OWNER}/${REPO} (${BRANCH}).`;
          return [];
        }
        if(resp.status === 403){
          const text = await resp.text();
          repoInfoEl.textContent = `GitHub API error (possible rate limit).`;
          console.warn('GitHub API 403:', text);
          return [];
        }
        const json = await resp.json();
        if(!Array.isArray(json)){
          repoInfoEl.textContent = `Unexpected GitHub response.`;
          console.warn(json);
          return [];
        }
        // json is array of items: { name, path, sha, size, url, html_url, git_url, type }
        return json.map(it => ({
          name: it.name,
          path: it.path,
          size: it.size,
          type: it.type, // "file" or "dir"
          download_url: it.download_url || null,
          html_url: it.html_url || null
        }));
      } catch(err){
        console.error("Fetch error", err);
        repoInfoEl.textContent = "Network error while trying to reach GitHub API.";
        return [];
      }
    }

    /* ---------- UI: populate and wire search/filter/sort ---------- */
    let ITEMS = [];

    function populate(items){
      ITEMS = items;
      renderGrid(items);
    }

    function renderGrid(items){
      resultsEl.innerHTML = "";
      if(!items || items.length === 0){
        emptyEl.style.display = "block";
        return;
      } else {
        emptyEl.style.display = "none";
      }
      const html = items.map(renderItem).join("\n");
      resultsEl.innerHTML = html;
    }

    // filtering
    function applyFilters(){
      const q = (document.getElementById("q").value || "").trim().toLowerCase();
      const type = document.getElementById("filterType").value;
      const sort = document.getElementById("sort").value;

      let filtered = ITEMS.slice();

      if(type){
        filtered = filtered.filter(it => it.type === type);
      }
      if(q){
        filtered = filtered.filter(it => (it.name + " " + it.path).toLowerCase().includes(q));
      }

      // Sorting
      if(sort === "name"){
        filtered.sort((a,b)=> a.name.localeCompare(b.name, undefined, {sensitivity:'base'}));
      } else if(sort === "name_desc"){
        filtered.sort((a,b)=> b.name.localeCompare(a.name, undefined, {sensitivity:'base'}));
      } else if(sort === "type"){
        filtered.sort((a,b)=> a.type.localeCompare(b.type));
      }

      renderGrid(filtered);
    }

    // Wire up controls
    document.getElementById("q").addEventListener("input", ()=> applyFilters());
    document.getElementById("filterType").addEventListener("change", ()=> applyFilters());
    document.getElementById("sort").addEventListener("change", ()=> applyFilters());

    /* ---------- Initialize ---------- */
    (async function init(){
      // Show simple loading state
      repoInfoEl.textContent = "Detecting repository and loading index...";
      const items = await fetchContents();
      // If nothing returned, try fallback: attempt to fetch plain HTML directory listing (GH Pages)
      if(items.length === 0){
        // Try fetching /html/ endpoint and parse links as fallback (useful for GitHub Pages static sites).
        try {
          const fallback = await fetch('/html/', {mode:'cors'});
          if(fallback.ok){
            const text = await fallback.text();
            // parse a tags that link to .html
            const parser = new DOMParser();
            const doc = parser.parseFromString(text, 'text/html');
            const anchors = Array.from(doc.querySelectorAll('a')).filter(a => a.getAttribute('href'));
            const parsed = anchors.map(a => {
              const href = a.getAttribute('href');
              const name = href.split('/').filter(Boolean).pop() || href;
              return {
                name,
                path: `AutoPublish/output/html/${name}`,
                size: null,
                type: name.endsWith('/') ? 'dir' : (name.match(/\.(html?|md|txt)$/i) ? 'file' : 'file'),
                download_url: `./html/${name}`
              };
            }).filter(Boolean);
            if(parsed.length){
              repoInfoEl.textContent = `Loaded directory listing fallback from /html/. Rendering ${parsed.length} items.`;
              populate(parsed);
              return;
            }
          }
        } catch(e){
          // ignore fallback errors
        }
      }
      populate(items);
    })();
  </script>
</body>
</html>
